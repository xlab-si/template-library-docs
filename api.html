<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Template Library REST API &mdash; Template Library  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="_static/xlab-favicon-16x16.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Template Library CLI" href="cli.html" />
    <link rel="prev" title="Template Library GUI" href="gui.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Template Library
            <img src="_static/xopera-tps-mark-black-mid.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui.html">Template Library GUI</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Template Library REST API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#public-access">Public access</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rest-api-design">REST API design</a></li>
<li class="toctree-l2"><a class="reference internal" href="#swagger-ui-web-interface">Swagger UI web interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rest-api-usage">REST API usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">Public access</a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-login-and-authentication">User login and authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="#users-templates-and-groups">Users, templates and groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#template-group-access">Template group access</a></li>
<li class="toctree-l3"><a class="reference internal" href="#versioning">Versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-with-curl">Example with curl</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Template Library CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugin.html">Template Library plugin for VS Code/Eclipse Che</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Get in touch</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/xlab-si/template-library-docs">GitHub</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Template Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Template Library REST API</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/api.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="template-library-rest-api">
<span id="api"></span><h1>Template Library REST API<a class="headerlink" href="#template-library-rest-api" title="Permalink to this headline"></a></h1>
<p>This section explains usage of the Template Library REST API.
Template Library REST API is written in Kotlin programming language using KTOR framework and provides several endpoints
to access Template Library’s data from storage.</p>
<div class="section" id="public-access">
<h2>Public access<a class="headerlink" href="#public-access" title="Permalink to this headline"></a></h2>
<p>REST API is currently accessible on <a class="reference external" href="https://template-library-xopera.xlab.si/api/">template-library-xopera.xlab.si/api/</a>.</p>
</div>
<div class="section" id="rest-api-design">
<span id="id1"></span><h2>REST API design<a class="headerlink" href="#rest-api-design" title="Permalink to this headline"></a></h2>
<p>REST API Swagger design is shown on the image below (<a class="reference internal" href="#id2"><span class="std std-numref">Fig. 4</span></a>).</p>
<div class="figure align-center" id="id12">
<span id="id2"></span><a class="reference external image-reference" href="_images/rest-api.png"><img alt="_images/rest-api.png" src="_images/rest-api.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-number">Fig. 4 </span><span class="caption-text">Template Library REST API design.</span><a class="headerlink" href="#id12" title="Permalink to this image"></a></p>
</div>
<p>Endpoints are linked into bigger groups that are explained in a table below:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 72%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Endpoint group</p></th>
<th class="head"><p>Purpose and description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>public</p></td>
<td><p>Publicly available endpoints</p></td>
</tr>
<tr class="row-odd"><td><p>users</p></td>
<td><p>Operations about users</p></td>
</tr>
<tr class="row-even"><td><p>userGroups</p></td>
<td><p>Operations about groups of users</p></td>
</tr>
<tr class="row-odd"><td><p>templateGroups</p></td>
<td><p>Operations about groups of templates</p></td>
</tr>
<tr class="row-even"><td><p>templateTypes</p></td>
<td><p>Operations for TOSCA template types</p></td>
</tr>
<tr class="row-odd"><td><p>templates</p></td>
<td><p>Access to TOSCA templates</p></td>
</tr>
</tbody>
</table>
<p>Mostly the requests include JSON objects for the transmission of the data.
With some requests you can also use multipart objects.</p>
</div>
<div class="section" id="swagger-ui-web-interface">
<span id="id3"></span><h2>Swagger UI web interface<a class="headerlink" href="#swagger-ui-web-interface" title="Permalink to this headline"></a></h2>
<p>For better user experience and testing the REST API has its own OpenAPI specification and can be therefore publicly
accessed through Swagger UI on <a class="reference external" href="https://template-library-xopera.xlab.si/swagger/">template-library-xopera.xlab.si/swagger/</a>.
This part will help you to interact with API easily since all the endpoints can be accessed from here.</p>
</div>
<div class="section" id="rest-api-usage">
<span id="id4"></span><h2>REST API usage<a class="headerlink" href="#rest-api-usage" title="Permalink to this headline"></a></h2>
<p>This part explains the usage of the Template Library REST API.</p>
<div class="section" id="id5">
<span id="id6"></span><h3>Public access<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h3>
<p>To give users some idea on how Template Library works without having to create an account and login, we have opened
some endpoints (with GET requests) publicly.
These endpoints start with <em>/public</em> prefix and can be accessed from anywhere (e.g. from console with curl or from
Swagger UI and so on).</p>
</div>
<div class="section" id="user-login-and-authentication">
<span id="id7"></span><h3>User login and authentication<a class="headerlink" href="#user-login-and-authentication" title="Permalink to this headline"></a></h3>
<p>Template Library REST API authentication goes through Open Source Identity and Access Management called <a class="reference external" href="https://www.keycloak.org/">Keycloak</a>.
Keycloak instance is accessible at <a class="reference external" href="https://openid-xopera.xlab.si">openid-xopera.xlab.si</a>.
Apart from XLAB Keycloak users, there we also connected other identity providers that have their own users such as
RADON Keycloak users (go to <a class="reference external" href="https://openid-xopera.xlab.si/auth/realms/keycloak">openid-xopera.xlab.si/auth/realms/keycloak</a>
(or <a class="reference external" href="https://openid-xopera.xlab.si/auth/realms/keycloak">openid-xopera.xlab.si/auth/realms/keycloak</a>), click on button <span class="guilabel">RADON authentication</span> and you will be
redirected to RADON Eclipse Che instance where you can log in).</p>
<p>Template Library REST API is integrated with Keycloak(Eclipse Che) authentication.
So, if try to initiate a request (for instance on <code class="docutils literal notranslate"><span class="pre">api/users</span></code> from browser address bar) targeting any the of REST API
endpoints you need to be logged in into your Keycloak account.
If you are not logged in, you will be redirected to the url where you can log in with your Keycloak user credentials.
After that you will be redirected back to the REST API endpoint the request was initiated from.
Then you will be able to use all REST API endpoints manually or from Eclipse Che.</p>
<div class="figure align-center" id="id13">
<span id="keycloak-auth"></span><a class="reference external image-reference" href="_images/keycloak-auth.png"><img alt="_images/keycloak-auth.png" src="_images/keycloak-auth.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">Keycloak auth redirection.</span><a class="headerlink" href="#id13" title="Permalink to this image"></a></p>
</div>
<div class="figure align-center" id="id14">
<span id="keycloak-auth2"></span><a class="reference external image-reference" href="_images/keycloak-auth2.png"><img alt="_images/keycloak-auth2.png" src="_images/keycloak-auth2.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-number">Fig. 6 </span><span class="caption-text">Keycloak authentication including identity providers.</span><a class="headerlink" href="#id14" title="Permalink to this image"></a></p>
</div>
<p>You can retrieve the current user data with GET request on <code class="docutils literal notranslate"><span class="pre">api/users/current</span></code> and logout from Template Library you
can use the <code class="docutils literal notranslate"><span class="pre">api/users/current/logout</span></code> endpoint.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Keycloak redirection will probably not work at first if you try to send the request from the Swagger UI
so rather use browser address bar or for instance curl from Eclipse Che shell script when accessing the API for the
first time.
After the first login the Keycloak cookies will be stored into browser and you will be able to use Swagger UI as
well.</p>
</div>
</div>
<div class="section" id="users-templates-and-groups">
<span id="id8"></span><h3>Users, templates and groups<a class="headerlink" href="#users-templates-and-groups" title="Permalink to this headline"></a></h3>
<p>So now, when you are authorized, you can proceed with your actions.
The logical workflow would feature creating a new group at first which will be a structure where you will gather you
templates and connect them with users who will be able to add their own templates to the group.
To create a new group of users use a POST request on <code class="docutils literal notranslate"><span class="pre">/userGroups</span></code>.
You will have to provide the following params in the request:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>name</p></td>
<td><p>Unique name of the group</p></td>
</tr>
<tr class="row-odd"><td><p>description</p></td>
<td><p>Group description</p></td>
</tr>
</tbody>
</table>
<p>After the group is created, the next step would be to add users to the group.
To do that use the <code class="docutils literal notranslate"><span class="pre">/users/{username}/groups</span></code> endpoint and fill in the properties below (currently only group owners
can add new users, <code class="docutils literal notranslate"><span class="pre">groupId</span></code> and <code class="docutils literal notranslate"><span class="pre">groupName</span></code> params are mutually exclusive):</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>username</p></td>
<td><p>Username (find it using other requests)</p></td>
</tr>
<tr class="row-odd"><td><p>groupId</p></td>
<td><p>Group id (find it using other requests)</p></td>
</tr>
<tr class="row-even"><td><p>groupName</p></td>
<td><p>Group name (find it using other requests)</p></td>
</tr>
</tbody>
</table>
<p>After that action user is a part of the group and he will be able to see all the templates from all the linked template
groups.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All REST API plain text parameters that you send within you request have various input checks and limitations
in characters and length.
This includes names, passwords and files.</p>
</div>
<p>Template Library sees templates as entities marked mainly with TOSCA template files.
The all idea behind that is that TOSCA standard is very complex and consists of several definitions and types (nodes,
relationships, capabilities and so on) so instead of putting all those definitions into one giant service template file
it is much nicer to dismantle your large TOSCA blueprint to pieces or models.
Ideally each model is actually a small TOSCA template or <a class="reference external" href="https://docs.oasis-open.org/tosca/TOSCA-Simple-Profile-YAML/v1.3/cos01/TOSCA-Simple-Profile-YAML-v1.3-cos01.html#_Toc26969474">TOSCA CSAR</a> with only one relevant type (e.g node type)
defined.
The (TOSCA) template types are one of the crucial things that allow us to distinguish modules thoroughly.
The types used in Template Library are shown in the table below and can also be fetched through <code class="docutils literal notranslate"><span class="pre">/templateTypes</span></code>
endpoint.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 79%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Template type</p></th>
<th class="head"><p>Purpose and description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>data</p></td>
<td><p>TOSCA data type</p></td>
</tr>
<tr class="row-odd"><td><p>artifact</p></td>
<td><p>TOSCA artifact type</p></td>
</tr>
<tr class="row-even"><td><p>capability</p></td>
<td><p>TOSCA capability type</p></td>
</tr>
<tr class="row-odd"><td><p>requirement</p></td>
<td><p>TOSCA requirement type</p></td>
</tr>
<tr class="row-even"><td><p>relationship</p></td>
<td><p>TOSCA relationship type</p></td>
</tr>
<tr class="row-odd"><td><p>interface</p></td>
<td><p>TOSCA interface type</p></td>
</tr>
<tr class="row-even"><td><p>node</p></td>
<td><p>TOSCA node type</p></td>
</tr>
<tr class="row-odd"><td><p>group</p></td>
<td><p>TOSCA group type</p></td>
</tr>
<tr class="row-even"><td><p>policy</p></td>
<td><p>TOSCA policy type</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">blueprint</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Full application blueprint (usually a zip archive or a</div>
<div class="line">compressed <a class="reference external" href="https://docs.oasis-open.org/tosca/TOSCA-Simple-Profile-YAML/v1.3/cos01/TOSCA-Simple-Profile-YAML-v1.3-cos01.html#_Toc26969474">TOSCA CSAR</a>)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>other</p></td>
<td><p>Other definitions</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Your modules can include a lot of files - for instance TOSCA templates, Ansible playbooks, configuration files and
so on so keep in mind that you will have to upload them as a compressed archive (like zip or tar).
We recommend you to use <a class="reference external" href="https://docs.oasis-open.org/tosca/TOSCA-Simple-Profile-YAML/v1.3/cos01/TOSCA-Simple-Profile-YAML-v1.3-cos01.html#_Toc26969474">TOSCA CSAR</a> structure and then pack your modules to a zip file, which you will upload to
TPS.</p>
</div>
<p>So, as you can see from the table you will have to pick the suitable type.
You can even save the whole application blueprints (<a class="reference external" href="https://docs.oasis-open.org/tosca/TOSCA-Simple-Profile-YAML/v1.3/cos01/TOSCA-Simple-Profile-YAML-v1.3-cos01.html#_Toc26969474">TOSCA CSAR</a> files) for the cases when you have prepared you
solution and it cannot be simply divided into smaller pieces.
The module with template also should be linked to its implementations which are the actual actuators for different
automation tools (i.e. Ansible playbooks, Chef recipes, Puppet scripts and so on) that are executed by the TOSCA
orchestrator (such as <code class="docutils literal notranslate"><span class="pre">opera</span></code>).
In this perspective module could be for instance AWS S3 bucket with very simple TOSCA template that would include just
the node type for the bucket like in the TOSCA <code class="docutils literal notranslate"><span class="pre">service.yml</span></code> template below.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">tosca_definitions_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tosca_simple_yaml_1_3</span>

<span class="nt">node_types</span><span class="p">:</span>
  <span class="nt">radon.nodes.s3_bucket</span><span class="p">:</span>
    <span class="nt">derived_from</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tosca.nodes.SoftwareComponent</span>
    <span class="nt">properties</span><span class="p">:</span>
      <span class="nt">bucket_name</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
        <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The name of the bucket</span>
      <span class="nt">aws_region</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
        <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS region</span>
    <span class="nt">interfaces</span><span class="p">:</span>
      <span class="nt">Standard</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tosca.interfaces.node.lifecycle.Standard</span>
        <span class="nt">inputs</span><span class="p">:</span>
          <span class="nt">bucket_name</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> default</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> get_property</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">SELF</span><span class="p p-Indicator">,</span> <span class="nv">bucket_name</span><span class="p p-Indicator">]</span> <span class="p p-Indicator">},</span><span class="nt"> type</span><span class="p">:</span> <span class="nv">string</span> <span class="p p-Indicator">}</span>
          <span class="nt">aws_region</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> default</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> get_property</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">SELF</span><span class="p p-Indicator">,</span> <span class="nv">aws_region</span><span class="p p-Indicator">]</span> <span class="p p-Indicator">},</span><span class="nt"> type</span><span class="p">:</span> <span class="nv">string</span> <span class="p p-Indicator">}</span>
        <span class="nt">operations</span><span class="p">:</span>
          <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">playbooks/create.yml</span>
          <span class="nt">delete</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">playbooks/delete.yml</span>
<span class="nn">...</span>
</pre></div>
</div>
<p>The template also has a link to two implementations in the form of Ansible playbooks which are also part of the module.
The first one is the <code class="docutils literal notranslate"><span class="pre">create.yml</span></code> used for the create TOSCA operation and is shown below.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">all</span>
  <span class="nt">gather_facts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;Create</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">S3</span><span class="nv"> </span><span class="s">bucket</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">bucket_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">s3_bucket</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">bucket_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class="nt">region</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">aws_region</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="nn">...</span>
</pre></div>
</div>
<p>The second playbook (<code class="docutils literal notranslate"><span class="pre">delete.yml</span></code>, see below) is for the delete TOSCA operation and could be used for undeployment.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">all</span>
  <span class="nt">gather_facts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;Remove</span><span class="nv"> </span><span class="s">S3</span><span class="nv"> </span><span class="s">bucket</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">bucket_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">s3_bucket</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">bucket_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">region</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">aws_region</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
        <span class="nt">force</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="nn">...</span>
</pre></div>
</div>
<p>So, these three files basically depict a module (which is basically a compressed <a class="reference external" href="https://docs.oasis-open.org/tosca/TOSCA-Simple-Profile-YAML/v1.3/cos01/TOSCA-Simple-Profile-YAML-v1.3-cos01.html#_Toc26969474">TOSCA CSAR</a> or zip archive).
Along with the metadata the module definition is complete.
So, if you want to add your new module to the Template Library you should use <code class="docutils literal notranslate"><span class="pre">/templates</span></code> endpoint and provide the
following information:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>name</p></td>
<td><p>Short module name (e.g. aws_bucket)</p></td>
</tr>
<tr class="row-odd"><td><p>description</p></td>
<td><p>Module description (e.g. AWS bucket node type)</p></td>
</tr>
<tr class="row-even"><td><p>templateTypeName</p></td>
<td><p>Template type unique name identifier (e.g. node)</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">publicAccess</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Specify if module should be private/public</div>
<div class="line">(private templates are only visible in groups)</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>After that your template - module has been added to the Template Library.
You can see that there is no space to upload your module archive (i.e. your TOSCA YAML template files, their
implementations - e.g. Ansible playbooks and all the other accompanying) in the request above.
That is because you will add your files later on when creating a new version of your module.
The next step you can take is to add your module to the proper group (if it already exists, otherwise you will have to
create it by yourself).
So if we turn back to the simple example of <code class="docutils literal notranslate"><span class="pre">aws_bucket</span></code> module this would probably fit in the group called AWS or
something similar.</p>
<p>To create a new group of templates use a POST request on <code class="docutils literal notranslate"><span class="pre">/templateGroups</span></code> where you will have to provide the
following params in the request:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>name</p></td>
<td><p>Unique name of the group</p></td>
</tr>
<tr class="row-odd"><td><p>description</p></td>
<td><p>Group description</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">publicAccess</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="line-block">
<div class="line">Specify if group should be private/public</div>
<div class="line">(private groups aren’t visible for other users)</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Template groups are meant to serve as an abstraction layer for grouping together the connected templates (AWS, Azure,
GCP, OpenFaas, etc.).
Private template groups can contain private or public templates and are accessed by giving access to a specific user
group, whereas public template groups can contain only public templates and can be accessed by everyone.</p>
<p>To add template to the created template group use <code class="docutils literal notranslate"><span class="pre">/template/{templateName}/groups</span></code> endpoint and provide the request
params below (currently only group owners can add new templates) where <code class="docutils literal notranslate"><span class="pre">groupId</span></code> and <code class="docutils literal notranslate"><span class="pre">groupName</span></code> params are
mutually exclusive:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>templateName</p></td>
<td><p>Template name</p></td>
</tr>
<tr class="row-odd"><td><p>groupId</p></td>
<td><p>Group id (find it using other requests)</p></td>
</tr>
<tr class="row-even"><td><p>groupName</p></td>
<td><p>Group name (find it using other requests)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="template-group-access">
<span id="id9"></span><h3>Template group access<a class="headerlink" href="#template-group-access" title="Permalink to this headline"></a></h3>
<p>To be able to share private templates with other users it is possible to link groups of users to the groups of templates
(currently it is not possible to grant access for a single user to a single template).</p>
<p>To add access to templates fot the whole user group use
<code class="docutils literal notranslate"><span class="pre">/userGroups/{userGroupName}/templateGroup/{templateGroupName}</span></code> REST API endpoint and provide the following
params:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 72%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>userGroupName</p></td>
<td><p>Name of the user group</p></td>
</tr>
<tr class="row-odd"><td><p>templateGroupName</p></td>
<td><p>Name of the template group</p></td>
</tr>
</tbody>
</table>
<p>When template group is linked to user group its templates can be accessed by all group users even if they are private.
If the template is public anyone can access it so if you want to keep your template just for yourself set its access to
private and keep it away from any template groups.</p>
</div>
<div class="section" id="versioning">
<span id="id10"></span><h3>Versioning<a class="headerlink" href="#versioning" title="Permalink to this headline"></a></h3>
<p>Modules as TOSCA templates can change through time.
You can modify TOSCA YAML profile version, add some new properties, attributes or inputs, you can provide new
implementations (Ansible playbooks) or completely change the TOSCA template.
To realize that and to save older features module templates are viewed through versions.
Each version of module is unique and immutable and therefore previous versions cannot be changed.
This idea of everlasting module versions originates from the Python Package Index (PyPI) which was our inspiration when
designing the Template Library solution.
In PyPI every Python package version is fixed.
Even if some older versions of the package are dormant and are not being used anymore they are still present since you
never now when you want to relive your past, go back and maybe resuscitate some forgotten features.</p>
<p>To add your new version of the template send a POST request on the <code class="docutils literal notranslate"><span class="pre">/templates/{templateName}/versions/</span></code> endpoint
and provide the request attributes below:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 72%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>templateName</p></td>
<td><p>Name of the existing template</p></td>
</tr>
<tr class="row-odd"><td><p>versionName</p></td>
<td><p>Unique semantic template version name</p></td>
</tr>
<tr class="row-even"><td><p>readmeFile</p></td>
<td><p>Optional markdown README.md file with instructions</p></td>
</tr>
<tr class="row-odd"><td><p>templateFile</p></td>
<td><p>Compressed module files or TOSCA YAML template file</p></td>
</tr>
</tbody>
</table>
<p>After that your version is added and you can download it using <code class="docutils literal notranslate"><span class="pre">/versions/{versionName}/templateFile</span></code> endpoint.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>POST request on <code class="docutils literal notranslate"><span class="pre">/templates/{templateName}/versions/</span></code> has a body that includes multipart form data type.
So when using with <code class="docutils literal notranslate"><span class="pre">curl</span></code> and with other programming languages be careful.
The <code class="docutils literal notranslate"><span class="pre">templateFile</span></code> parameter should be an archive (like zip or tar) with your module files or a single TOSCA YAML
template.</p>
</div>
<p>To retrieve version info send a GET request on the <code class="docutils literal notranslate"><span class="pre">/templates/{templateName}/versions/{versionName}</span></code> endpoint.
To retrieve all version files use GET request on <code class="docutils literal notranslate"><span class="pre">/templates/{templateName}/versions/{versionName}/templateFile</span></code>.
This will give your compressed template file.
The response you get is visible in the image below <a class="reference internal" href="#api-file-response"><span class="std std-numref">Fig. 7</span></a> (or you can explore downloadable example
here: <a class="reference download internal" download="" href="_downloads/bc08149875b7f17ddff88c7d246020ad/AwsBucket_0.1.0.zip"><code class="xref download docutils literal notranslate"><span class="pre">AwsBucket_0.1.0.zip</span></code></a>).</p>
<div class="figure align-center" id="id15">
<span id="api-file-response"></span><a class="reference external image-reference" href="_images/api-file-response.png"><img alt="_images/api-file-response.png" src="_images/api-file-response.png" style="width: 70%;" /></a>
<p class="caption"><span class="caption-number">Fig. 7 </span><span class="caption-text">REST API Swagger UI download file response.</span><a class="headerlink" href="#id15" title="Permalink to this image"></a></p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Use GET request on <code class="docutils literal notranslate"><span class="pre">/templates/{templateName}/versions/{versionName}/readme</span></code> to retrieve README file for a
specific template version.</p>
</div>
</div>
<div class="section" id="example-with-curl">
<span id="id11"></span><h3>Example with curl<a class="headerlink" href="#example-with-curl" title="Permalink to this headline"></a></h3>
<p>The following code block shows an example of using the Template Library API through <code class="docutils literal notranslate"><span class="pre">curl</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># variables</span>
<span class="nv">api</span><span class="o">=</span><span class="s2">&quot;https://template-library-xopera.xlab.si/api&quot;</span>
<span class="nv">auth_base_url</span><span class="o">=</span><span class="s2">&quot;https://openid-xopera.xlab.si&quot;</span>

<span class="c1"># public Template Library endpoints can be used directly with curl without authentication</span>
curl -X GET <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/public/templateTypes&quot;</span>
curl -X GET <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/public/templates&quot;</span>
curl -X GET <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/public/templates/filter&quot;</span>
curl -X GET <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/public/templates/{templateName}/versions&quot;</span>
curl -X GET <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/public/templates/{templateName}/versions/{versionName}&quot;</span>
curl -X GET <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/public/templates/{templateName}/versions/{versionName}/templateFile&quot;</span>
curl -X GET <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/public/templates/{templateName}/versions/{versionName}/readme&quot;</span>

<span class="c1"># using secured endpoints requires Keycloak authentication</span>
<span class="nv">your_username</span><span class="o">=</span>YOUR_USERNAME
<span class="nv">your_password</span><span class="o">=</span>YOUR_PASSWORD

<span class="c1"># set cookiecurl and choose your auth method below</span>
<span class="nb">alias</span> <span class="nv">cookiecurl</span><span class="o">=</span><span class="s2">&quot;curl -sSL --cookie-jar cookiejar.txt --cookie cookiejar.txt&quot;</span>
<span class="nv">response_from_credentials_redirected_to_next_auth</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cookiecurl <span class="nv">$api</span>/users/current<span class="k">)</span><span class="s2">&quot;</span>

<span class="c1"># a) login flow - internal Keycloak auth (XLAB)</span>
<span class="nv">redirect_url_internal</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$response_from_credentials_redirected_to_next_auth</span> <span class="p">|</span> xmllint --html --xpath <span class="s2">&quot;string(//form[@id=&#39;kc-form-login&#39;]/@action)&quot;</span> - <span class="m">2</span>&gt;/dev/null<span class="k">)</span><span class="s2">&quot;</span>
<span class="nv">redirect_url</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$redirect_url_internal</span><span class="s2">&quot;</span>

<span class="c1"># b) login flow - RADON Keycloak auth (ENG)</span>
<span class="nv">redirect_url_to_radonauth</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$response_from_credentials_redirected_to_next_auth</span> <span class="p">|</span> xmllint --html --xpath <span class="s2">&quot;string(//a[@id=&#39;social-keycloak-oidc-provider-to-radon-eng-2&#39;]/@href)&quot;</span> - <span class="m">2</span>&gt;/dev/null<span class="k">)</span><span class="s2">&quot;</span>
<span class="nv">response_radonauth</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cookiecurl <span class="si">${</span><span class="nv">auth_base_url</span><span class="si">}${</span><span class="nv">redirect_url_to_radonauth</span><span class="si">}</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="nv">login_url_radonauth</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$response_radonauth</span> <span class="p">|</span> xmllint --html --xpath <span class="s2">&quot;string(//form[@id=&#39;kc-form-login&#39;]/@action)&quot;</span> - <span class="m">2</span>&gt;/dev/null<span class="k">)</span><span class="s2">&quot;</span>
cookiecurl <span class="s2">&quot;</span><span class="nv">$login_url_radonauth</span><span class="s2">&quot;</span> -d <span class="s2">&quot;username=</span><span class="nv">$your_username</span><span class="s2">&quot;</span> -d <span class="s2">&quot;password=</span><span class="nv">$your_password</span><span class="s2">&quot;</span> -d <span class="nv">credentialId</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nv">redirect_url</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$redirect_url_radonauth</span><span class="s2">&quot;</span>

<span class="c1"># c) login flow - RADON Keycloak auth (Azure)</span>
<span class="nv">redirect_url_to_radonauth</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$response_from_credentials_redirected_to_next_auth</span> <span class="p">|</span> xmllint --html --xpath <span class="s2">&quot;string(//a[@id=&#39;social-keycloak-oidc-provider-to-radon-azure&#39;]/@href)&quot;</span> - <span class="m">2</span>&gt;/dev/null<span class="k">)</span><span class="s2">&quot;</span>
<span class="nv">response_radonauth</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cookiecurl <span class="si">${</span><span class="nv">auth_base_url</span><span class="si">}${</span><span class="nv">redirect_url_to_radonauth</span><span class="si">}</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="nv">login_url_radonauth</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$response_radonauth</span> <span class="p">|</span> xmllint --html --xpath <span class="s2">&quot;string(//form[@id=&#39;kc-form-login&#39;]/@action)&quot;</span> - <span class="m">2</span>&gt;/dev/null<span class="k">)</span><span class="s2">&quot;</span>
cookiecurl <span class="s2">&quot;</span><span class="nv">$login_url_radonauth</span><span class="s2">&quot;</span> -d <span class="s2">&quot;username=</span><span class="nv">$your_username</span><span class="s2">&quot;</span> -d <span class="s2">&quot;password=</span><span class="nv">$your_password</span><span class="s2">&quot;</span> -d <span class="nv">credentialId</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nv">redirect_url</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$redirect_url_radonauth</span><span class="s2">&quot;</span>

<span class="c1"># final login step, sets cookies and automatically completes the /users/current request</span>
cookiecurl <span class="s2">&quot;</span><span class="nv">$redirect_url</span><span class="s2">&quot;</span> -d <span class="s2">&quot;username=</span><span class="nv">$your_username</span><span class="s2">&quot;</span> -d <span class="s2">&quot;password=</span><span class="nv">$your_password</span><span class="s2">&quot;</span> -d <span class="nv">credentialId</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="c1"># TPS requires you to be mindful</span>
cookiecurl <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/auth/consent&quot;</span> -XPOST -d <span class="s2">&quot;{\&quot;iAcknowledgePotentialDataLossAndAmAwareOfAllRisks\&quot;: true}&quot;</span>

<span class="c1"># usage of the secured TPS API endpoints</span>
cookiecurl -X GET <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/templateTypes&quot;</span>
cookiecurl -X GET <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/templates&quot;</span>
cookiecurl -X GET <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/templates/filter&quot;</span>
cookiecurl -X GET <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/templates/{templateName}/versions&quot;</span>
cookiecurl -X GET <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/templates/{templateName}/versions/{versionName}&quot;</span>
cookiecurl -X GET <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/templates/{templateName}/versions/{versionName}/templateFile&quot;</span>
cookiecurl -X GET <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/templates/{templateName}/versions/{versionName}/readme&quot;</span>
cookiecurl -X POST <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/templates&quot;</span> -d <span class="s2">&quot;{\&quot;name\&quot;: \&quot;MyTemplate\&quot;, \&quot;description\&quot;: \&quot;AWS blueprint\&quot;, \&quot;templateTypeName\&quot;: \&quot;blueprint\&quot;, \&quot;publicAccess\&quot;: true}&quot;</span>
cookiecurl -X POST <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/userGroups&quot;</span> -d <span class="s2">&quot;{\&quot;name\&quot;: \&quot;MyUserGroup\&quot;, \&quot;description\&quot;: \&quot;My users\&quot;}&quot;</span>
cookiecurl -X POST <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/templateGroups&quot;</span> -d <span class="s2">&quot;{\&quot;name\&quot;: \&quot;MyTemplateGroup\&quot;, \&quot;description\&quot;: \&quot;My TOSCA templates\&quot;, \&quot;publicAccess\&quot;: true}&quot;</span>
cookiecurl -X PUT <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/templates&quot;</span> -d <span class="s2">&quot;{\&quot;name\&quot;: \&quot;MyUpdatedTemplate\&quot;, \&quot;description\&quot;: \&quot;AWS blueprint\&quot;, \&quot;templateTypeName\&quot;: \&quot;blueprint\&quot;, \&quot;publicAccess\&quot;: false}&quot;</span>
cookiecurl -X PUT <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/userGroups&quot;</span> -d <span class="s2">&quot;{\&quot;name\&quot;: \&quot;MyUpdatedUserGroup\&quot;, \&quot;description\&quot;: \&quot;My updated users\&quot;}&quot;</span>
cookiecurl -X PUT <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/templateGroups&quot;</span> -d <span class="s2">&quot;{\&quot;name\&quot;: \&quot;MyUpdatedTemplateGroup\&quot;, \&quot;description\&quot;: \&quot;My updated TOSCA templates\&quot;, \&quot;publicAccess\&quot;: false}&quot;</span>
cookiecurl -X DELETE <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/templates?templateName={templateName}&#39;&quot;</span>
cookiecurl -X DELETE <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/userGroups?groupName={userGroupName}&#39;&quot;</span>userGroupName
cookiecurl -X DELETE <span class="s2">&quot;</span><span class="nv">$api</span><span class="s2">/templateGroups?groupName={templateGroupName}&#39;&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="gui.html" class="btn btn-neutral float-left" title="Template Library GUI" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cli.html" class="btn btn-neutral float-right" title="Template Library CLI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, xOpera team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>